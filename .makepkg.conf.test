CFLAGS="-march=native -mtune=native -O3 -pipe \
        -fno-plt -fexceptions -fopenmp \
        -falign-functions=64 -fno-math-errno -fno-trapping-math \
        -fomit-frame-pointer -fstack-clash-protection \
        -fPIC -Wp,-D_FORTIFY_SOURCE=3 \
        -fno-semantic-interposition -fgraphite-identity -floop-nest-optimize \
        -fdevirtualize-at-ltrans -fipa-pta -fipa-cp-clone \
        -funsafe-math-optimizations -ffinite-math-only \
        -fassociative-math -freciprocal-math \
        -funroll-loops -flto=auto -fuse-linker-plugin -fno-ident -ffast-math \
        -ftracer -fprefetch-loop-arrays -ftree-loop-distribution \
        -ftree-loop-vectorize -ftree-slp-vectorize \
        -fvect-cost-model=dynamic -fsimd-cost-model=dynamic \
        -funswitch-loops -fpredictive-commoning \
        -fgcse-after-reload -ftree-loop-im -fivopts \
        -fmodulo-sched -fmodulo-sched-allow-regmoves \
        -freschedule-modulo-scheduled-loops"
CXXFLAGS="$CFLAGS -Wp,-D_GLIBCXX_ASSERTIONS -fvisibility-inlines-hidden \
          -fdevirtualize-speculatively -fvirtual-function-elimination \
          -fno-rtti-data"
export CFLAGS_KERNEL="$CFLAGS -fno-stack-protector"
export CXXFLAGS_KERNEL="$CXXFLAGS -fno-stack-protector"
export CFLAGS_MODULE="$CFLAGS"
export CXXFLAGS_MODULE="$CXXFLAGS"
export KBUILD_CFLAGS="$CFLAGS -fno-stack-protector"
export KCFLAGS="-O3 -march=native"
export KCPPFLAGS="$KCFLAGS"
LDFLAGS="-Wl,-O2,--sort-common,--as-needed,-z,relro,-z,now,--gc-sections \
         -Wl,--icf=all -Wl,--strip-all -Wl,--hash-style=gnu \
         -Wl,-z,pack-relative-relocs"
RUSTFLAGS="-C opt-level=3 -C target-cpu=native -C codegen-units=1 -C lto=fat \
           -C link-arg=-Wl,-O2 -C panic=abort -C embed-bitcode=yes \
           -C force-frame-pointers=no"
MAKEFLAGS="-j$(($(nproc)*2))"
NINJAFLAGS="$MAKEFLAGS"
export CC="gcc"
export CXX="g++"
export AR="gcc-ar"
export NM="gcc-nm"
export RANLIB="gcc-ranlib"
export STRIP="strip"
COMPRESSZST="zstd -q --rm -19 -T0 --ultra"
COMPRESSZST_EXT=".zst"
COMPRESSXZ="xz -q --rm -9 -T0"
COMPRESSXZ_EXT=".xz"
OPTIONS=(strip docs !libtool !staticlibs emptydirs zipman purge !debug lto)
export MALLOC_MMAP_THRESHOLD_=131072
export MALLOC_TRIM_THRESHOLD_=131072
export MALLOC_TOP_PAD_=131072
export MALLOC_MMAP_MAX_=65536

ulimit -v unlimited
ulimit -m unlimited
